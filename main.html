<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=yes">
<title>기계설비 유지관리자 경력확인서 (반응형)</title>
<style>
    /* --- [기본 및 반응형 레이아웃 설정] --- */
    :root {
        --base-width: 210mm; /* A4 너비 */
        --content-bg: #555;
    }

    body { 
        background-color: var(--content-bg); 
        margin: 0; 
        padding: 0; 
        font-family: 'Malgun Gothic', 'Dotum', sans-serif; 
        overflow-x: hidden; /* 가로 스크롤 방지 (스케일링으로 처리) */
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    /* 반응형 래퍼: 스케일링의 기준점 */
    #responsive-wrapper {
        width: var(--base-width);
        transform-origin: top center; /* 중앙 상단 기준 축소 */
        transition: transform 0.2s ease;
        margin-top: 20px;
        margin-bottom: 80px; /* 모바일 하단 버튼 공간 확보 */
        box-shadow: 0 0 15px rgba(0,0,0,0.5);
    }

    .page-container {
        background-color: white; 
        width: 100%; /* 래퍼에 맞춤 */
        min-height: 297mm; 
        padding: 10mm 15mm; 
        box-sizing: border-box; 
        position: relative;
        display: flex;
        flex-direction: column;
    }

    /* --- [기존 스타일 유지 및 보완] --- */
    table { width: 100%; border-collapse: collapse; margin: 0; table-layout: fixed; }
    
    th, td { 
        border: 1px solid #000; 
        padding: 1px 3px; 
        vertical-align: middle; 
        word-break: keep-all; 
        font-size: 8.5pt;
        height: 24px;
        color: #000;
    }
    
    .no-side-outer tr th:first-child, .no-side-outer tr td:first-child { border-left: none !important; }
    .no-side-outer tr th:last-child, .no-side-outer tr td:last-child { border-right: none !important; }
    th { background-color: #e6e6e6; text-align: center; font-weight: normal; letter-spacing: -0.5px; }
    .border-top-thick { border-top: 2px solid #000 !important; }
    .border-bottom-thick { border-bottom: 2px solid #000 !important; }
    
    /* 입력 필드 스타일 */
    input, textarea, select {
        width: 100%; height: 100%; border: none; padding: 0; margin: 0;
        font-family: inherit; font-size: 8.5pt;
        background-color: transparent; outline: none; box-sizing: border-box;
        vertical-align: middle; color: #000;
        border-radius: 0; /* 모바일 사파리 등 기본 스타일 제거 */
        -webkit-appearance: none;
    }
    select { 
        padding-right: 15px; /* 화살표 공간 */
        background: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 10 10'%3E%3Cpath d='M0 0 L5 5 L10 0' fill='none' stroke='%23000' stroke-width='1.5'/%3E%3C/svg%3E") no-repeat right 2px center;
        background-size: 8px;
    }
    
    input:focus, textarea:focus, select:focus { background-color: #e8f0fe; }
    .empty-value { color: #999 !important; }
    ::placeholder { color: #999; font-size: 8pt; text-align: center; opacity: 0.7; }
    input:disabled, select:disabled { background-color: #f0f0f0; color: #aaa; cursor: not-allowed; }
    .center-text { text-align: center; }
    .left-text { text-align: left !important; padding-left: 5px; }
    .long-label { font-size: 7pt; letter-spacing: -0.8px; line-height: 1.1; }
    .nowrap-text { white-space: nowrap; }

    /* 데이트피커 스타일 */
    input[type="date"] { position: relative; }
    input[type="date"]::-webkit-calendar-picker-indicator {
        position: absolute; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%;
        opacity: 0; cursor: pointer;
    }

    /* 툴팁 스타일 */
    .custom-tooltip {
        position: absolute; z-index: 1000; pointer-events: none; opacity: 0; transition: opacity 0.3s ease;
        padding: 8px 12px; border-radius: 8px; font-size: 8pt; white-space: nowrap; font-weight: bold;
        background-color: #222; color: white;
        border: 2px solid transparent;
        background-image: linear-gradient(#222, #222), linear-gradient(135deg, #ff00cc, #3333ff, #00ccff);
        background-origin: border-box; background-clip: padding-box, border-box;
        box-shadow: 0 0 10px rgba(0, 204, 255, 0.5);
    }
    .custom-tooltip.show { opacity: 1; }
    .tooltip-container { position: relative; }

    /* --- [모바일/반응형 UI 컨트롤] --- */
    
    /* 버튼 바 (PC: 상단 우측, 모바일: 하단 고정) */
    .btn-bar { 
        position: fixed; z-index: 9999; display: flex; gap: 10px;
        backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        transition: all 0.3s ease;
    }

    /* 참여기간 계산기 패널 (반응형) */
    .calc-panel {
        position: fixed; top: 20px; left: 20px; z-index: 999;
        display: flex; flex-direction: column; gap: 5px;
        padding: 10px 15px; width: 140px;
        background: rgba(255, 140, 0, 0.85); 
        border: 1px solid rgba(255, 255, 255, 0.4);
        border-radius: 12px;
        color: white; font-family: 'Malgun Gothic', sans-serif;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        transition: transform 0.3s;
    }
    .calc-panel.collapsed { transform: translateX(-130px); opacity: 0.5; }
    .calc-toggle { position: absolute; right: -25px; top: 5px; width: 25px; height: 25px; background: orange; border-radius: 0 5px 5px 0; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 12px; }

    .calc-header { font-weight: bold; font-size: 10pt; border-bottom: 1px solid rgba(255,255,255,0.5); padding-bottom: 5px; margin-bottom: 5px; text-align: center; }
    .calc-row { display: flex; justify-content: space-between; align-items: center; }
    .calc-label { font-size: 9pt; }
    .calc-value { font-weight: bold; font-size: 14pt; }
    .calc-unit { font-size: 9pt; }

    button { 
        padding: 10px 14px; font-size: 13px; cursor: pointer; 
        border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; font-weight: bold; color: white; 
        box-shadow: 0 4px 10px rgba(0,0,0,0.2); white-space: nowrap;
    }

    /* 버튼 색상 */
    .btn-blue { background: #2980b9; }
    .btn-green { background: #27ae60; }
    .btn-pink { background: #e84393; }
    .btn-red { background: #c0392b; }

    /* PC 화면 설정 (> 768px) */
    @media screen and (min-width: 769px) {
        .btn-bar { top: 20px; right: 20px; flex-direction: row; }
    }

    /* 모바일 화면 설정 (<= 768px) 및 가로모드 */
    @media screen and (max-width: 768px), screen and (max-height: 600px) {
        body { padding-bottom: 70px; /* 하단 바 공간 */ }
        
        #responsive-wrapper { margin-top: 10px; }

        /* 하단 고정 네비게이션 바 */
        .btn-bar { 
            top: auto; bottom: 0; left: 0; right: 0;
            width: 100%; height: 60px;
            background: rgba(30, 30, 30, 0.9);
            justify-content: space-around;
            align-items: center;
            padding: 0 10px;
            box-sizing: border-box;
            gap: 5px;
        }
        
        .btn-bar button {
            flex: 1; padding: 8px 0; font-size: 11px; border-radius: 6px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 44px;
        }

        /* 계산기 패널 위치 조정 */
        .calc-panel { top: 10px; left: 10px; transform: scale(0.9); transform-origin: top left; }
    }

    /* 인쇄 모드 */
    @media print {
        @page { size: A4; margin: 10mm 15mm 0mm 15mm; }
        body { background: white; padding: 0; margin: 0; height: 100%; display: block; overflow: visible; }
        #responsive-wrapper { 
            transform: none !important; 
            width: 100% !important; 
            margin: 0 !important; 
            box-shadow: none !important;
        }
        .page-container { border: none; padding: 0; width: 100%; }
        .btn-bar, .calc-panel, .custom-tooltip, .calc-toggle { display: none !important; }
        
        /* 인쇄시 인풋 스타일 초기화 */
        input, textarea, select { -webkit-appearance: none; appearance: none; border: none; background: transparent; }
        select { background-image: none; padding-right: 0; }
    }
</style>
</head>
<body onload="initAllFields(); resizeForm();" onresize="resizeForm()">

<input type="file" id="file_input" style="display:none" accept=".json" onchange="loadFromFile(this)">

<div class="calc-panel" id="calcPanel">
    <div class="calc-toggle" onclick="document.getElementById('calcPanel').classList.toggle('collapsed')">◀</div>
    <div class="calc-header">📅 참여기간 계산기</div>
    <div class="calc-row">
        <span class="calc-label">연번 1</span>
        <div><span id="panel_days_1" class="calc-value">0</span><span class="calc-unit">일</span></div>
    </div>
    <div class="calc-row">
        <span class="calc-label">연번 2</span>
        <div><span id="panel_days_2" class="calc-value">0</span><span class="calc-unit">일</span></div>
    </div>
</div>

<div class="btn-bar">
    <button class="btn-blue" onclick="saveToFile()">💾 저장</button>
    <button class="btn-green" onclick="triggerFileLoad()">📂 열기</button>
    <button class="btn-pink" onclick="validateAndPrint()">🖨️ 인쇄</button>
    <button class="btn-red" onclick="if(confirm('초기화 하시겠습니까?')) location.reload();">🔄 초기화</button>
</div>

<div id="responsive-wrapper">
    <div class="page-container">
        <div style="font-size: 8pt; margin-bottom: 15px; font-weight:bold;">
            ■ 건설기술 진흥법 시행규칙 [별지 제12호서식] &lt;개정 2024. 4. 23.&gt;
        </div>

        <div style="position: relative; height: 60px; margin-bottom: 20px;">
            <h1 style="position: absolute; width: 100%; top: 60%; transform: translateY(-50%); text-align: center; font-size: 20pt; letter-spacing: 5px; margin: 0; padding-right: 150px; box-sizing: border-box;">
                경력확인서
            </h1>
            
            <table style="width: 180px; position: absolute; top: -20px; right: 0; border: 2px solid black; height: 40px;">
                <colgroup><col style="width: 40%"><col style="width: 40%"><col style="width: 40%"></colgroup>
                <tr>
                    <th style="background:#fff; font-size:7pt; padding:2px 0; height:7px;">구분</th>
                    <th style="background:#fff; font-size:7pt; padding:2px 0; height:7px;">인사부서</th>
                    <th style="background:#fff; font-size:7pt; padding:2px 0; height:7px;">사업부서</th>
                </tr>
                <tr>
                    <th style="background:#fff; font-size:7pt; padding:2px 0; height:7px;">부서명</th>
                    <td style="height:7px;"></td> <td style="height:7px;"></td>
                </tr>
                <tr>
                    <th style="background:#fff; font-size:7pt; padding:2px 0; height:7px;">담당자</th>
                    <td style="text-align:right; vertical-align:bottom; font-size:7pt; padding:0 2px; height:7px;">(인)</td>
                    <td style="text-align:right; vertical-align:bottom; font-size:7pt; padding:0 2px; height:7px;">(인)</td>
                </tr>
                <tr>
                    <th style="background:#fff; font-size:7pt; padding:2px 0; height:7px;">연락처</th>
                    <td style="height:7px;"></td> <td style="height:7px;"></td>
                </tr>
                <tr>
                    <th style="background:#fff; font-size:7pt; padding:2px 0; height:7px;">발급번호</th>
                    <td colspan="2" style="height:7px;"></td>
                </tr>
            </table>
        </div>

        <table class="border-top-thick no-side-outer" style="margin-bottom: 10px;">
            <colgroup>
                <col style="width: 10%;"> 
                <col style="width: 10%;"> <col style="width: 20%;"> 
                <col style="width: 12%;"> <col style="width: 18%;"> 
                <col style="width: 13%;"> <col style="width: 17%;">
            </colgroup>
            <tr>
                <th rowspan="2">인적<br>사항</th>
                <th>① 성 명</th>
                <td>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <input type="text" id="user_name" style="width:60%;">
                        <span class="nowrap-text" style="font-size:7pt; color:#888;">(서명 또는 인)</span>
                    </div>
                </td>
                <th>주민등록번호</th>
                <td><input type="text" id="user_id" class="center-text" oninput="formatNumber(this, 'id')"></td>
                <th class="long-label">휴대전화번호<br>(전화번호)</th>
                <td><input type="tel" id="user_phone" class="center-text" oninput="formatCompPhone(this)" maxlength="12"></td>
            </tr>
            <tr>
                <th>② 주 소</th>
                <td colspan="3"><input type="text" id="user_addr" oninput="autoFitText(this)"></td>
                <th>전자우편주소</th>
                <td><input type="email" id="user_email"></td>
            </tr>
        </table>
        
        <table class="no-side-outer">
            <colgroup>
                <col style="width: 10%;"> 
                <col style="width: 10%;"> <col style="width: 20%;"> 
                <col style="width: 12%;"> <col style="width: 18%;"> 
                <col style="width: 13%;"> <col style="width: 17%;">
            </colgroup>
            <tr class="border-top-thick">
                <th rowspan="3">소속<br>회사</th>
                <th colspan="2">③ 회사명 및 대표자</th>
                <td colspan="2"><input type="text" id="comp_name" oninput="autoFitText(this)"></td>
                <th class="long-label" style="font-size:7pt;">사업자등록번호<br>(법인등록번호)</th>
                <td><input type="text" id="comp_biz" class="center-text" oninput="formatNumber(this, 'biz')"></td>
            </tr>
            <tr>
                <th colspan="2">영업소 소재지</th>
                <td colspan="2"><input type="text" id="comp_addr" oninput="autoFitText(this)"></td>
                <th class="long-label">④ 건설업종<br>(등록번호)</th>
                <td><input type="text" id="comp_sector"></td>
            </tr>
            <tr>
                <td colspan="4" style="padding:0; border-right:1px solid #000;">
                    <div style="display:flex; height:100%; width:100%;">
                        <div style="flex:1; border-right:1px solid #000; background:#e6e6e6; display:flex; align-items:center; justify-content:center; font-size:8.5pt;">⑤ 입사일</div>
                        <div style="flex:1; border-right:1px solid #000; padding:0 2px;"><input type="date" id="join_date" required onchange="validateAllDates(1); validateAllDates(2);"></div>
                        <div style="flex:1; border-right:1px solid #000; background:#e6e6e6; display:flex; align-items:center; justify-content:center; font-size:8.5pt;">⑥ 퇴사일</div>
                        <div style="flex:1; padding:0 2px; display:flex; align-items:center; justify-content:center;">
                            <input type="date" id="retire_date" required style="width: 100%;" onchange="validateAllDates(1); validateAllDates(2);">
                            <div id="retire_text" style="display:none; width:100%; text-align:center; font-size:8.5pt;">재직중</div>
                            <label class="working-check-label" title="현재 근무 중이면 체크하세요" style="display:flex; align-items:center;">
                                <input type="checkbox" id="chk_working" onchange="toggleRetireDate()">재직
                            </label>
                        </div>
                    </div>
                </td>
                <th>전화번호</th>
                <td><input type="tel" id="comp_phone" class="center-text" oninput="formatCompPhone(this)" maxlength="12"></td>
            </tr>
        </table>

        <div style="text-align:center; font-weight:bold; background:#eaeaea; border:1px solid #000; border-bottom:none; border-left:none; border-right:none; margin-top:5px; height:24px; line-height:24px; font-size:9pt;" class="border-top-thick">
            기 술 경 력
        </div>

        <table class="border-bottom-thick no-side-outer">
            <colgroup>
                <col style="width: 4%;"> 
                <col style="width: 24%;"> 
                <col style="width: 24%;"> 
                <col style="width: 24%;"> 
                <col style="width: 24%;">
            </colgroup>
            
            <tr>
                <th rowspan="5" class="border-bottom-thick">연<br>번</th>
                <th class="left-text">⑦ 사업기간(착공~준공)</th>
                <th colspan="3" class="left-text">⑨ 참여사업명</th>
            </tr>
            <tr>
                <th class="left-text">⑧ 참여기간(시작~종료)</th>
                <th colspan="3" class="left-text">⑩ 발주자(청)</th>
            </tr>
            <tr>
                <td colspan="4" style="padding:0; border:none;">
                    <table style="width:100%; border:none;">
                        <colgroup>
                            <col style="width:25%;"> <col style="width:25%;"> <col style="width:25%;"> <col style="width:25%;">
                        </colgroup>
                        <tr>
                            <th class="left-text" style="border-left:none; border-top:none;">⑪ 공사종류</th>
                            <th class="left-text" style="border-top:none;">⑫ 공사(용역)금액(백만원)</th>
                            <th class="left-text" style="border-top:none;">⑬ 직무분야</th>
                            <th class="left-text" style="border-top:none; border-right:none;">⑭ 전문분야</th>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td colspan="4" style="padding:0; border:none;">
                    <table style="width:100%; border:none;"style="width:100%; border-collapse: collapse; table-layout: fixed; border: 1px solid #ccc;">        
                        <colgroup>
                            <col style="width:50%;"> <col style="width:18%;"> <col style="width:7%;"> <col style="width:25%;">
                        </colgroup>
                        <tr>
                            <th class="left-text" style="border-left:none; border-top:none;">⑮ 공사(용역)개요(150자 이내 빈칸 포함)</th>
                            <th class="left-text" style="border-top:none;">⑯ 담당업무</th>
                            <th class="left-text" style="border-top:none; font-size: 6.5pt; letter-spacing: -0.5px; padding: 0; line-height: 24px; text-align:center; white-space:nowrap;">⑰ 책임정도</th>
                            <th class="left-text" style="border-top:none; border-right:none;">⑱ 직위</th>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td colspan="4" style="padding:0; border:none;">
                    <table style="width:100%; border:none;">
                        <colgroup>
                            <col style="width:25%;"> <col style="width:25%;"> <col style="width:25%;"> <col style="width:25%;">
                        </colgroup>
                        <tr>
                            <th class="left-text" style="border-left:none; border-top:none; border-bottom:1px solid black;">⑲ 적용 공법</th>
                            <th class="left-text" style="border-top:none; border-bottom:1px solid black;">⑳ 적용 융ㆍ복합건설기술</th>
                            <th class="left-text" style="border-top:none; border-bottom:1px solid black;">㉑ 적용 신기술 등</th>
                            <th class="left-text" style="border-top:none; border-bottom:1px solid black; border-right:none;">㉒ 시설물 종류</th>
                        </tr>
                    </table>
                </td>
            </tr>

            <tr>
                <th rowspan="5" class="border-bottom-thick" style="background:#fff;">1</th>
                <td style="background-color: #f0f0f0 !important; cursor: not-allowed;"></td>
                <td colspan="3" class="tooltip-container">
                    <input type="text" id="proj_name_1" class="left-text e1-req" onfocus="showTooltip(this)" onblur="hideTooltip(this)" oninput="checkEntry1(); checkHeadquarters(1)">
                    <div class="custom-tooltip" id="tooltip_proj_name_1">(예시) 00아파트 기계설비 유지관리, 00건물 기계설비 유지관리</div>
                </td>
            </tr>
            <tr>
                <td><div style="display:flex;"><input type="date" id="part_start_1" required class="e1-req" style="width:48%;" onchange="validateAllDates(1)" oninput="checkEntry1()">~<input type="date" id="part_end_1" required class="e1-req" style="width:48%;" onchange="validateAllDates(1)" oninput="checkEntry1()"></div></td>
                <td colspan="3" style="cursor: not-allowed;"><input type="text" class="left-text" disabled style="cursor: not-allowed;"></td>
            </tr>
            <tr>
                <td colspan="4" style="padding:0; border:none;">
                    <table style="width:100%; border:none;">
                        <colgroup><col style="width:25%;"><col style="width:25%;"><col style="width:25%;"><col style="width:25%;"></colgroup>
                        <tr>
                            <td style="border-left:none; border-top:none;"><input type="text" class="left-text" disabled></td>
                            <td style="border-top:none;"><input type="text" class="left-text" id="amt_1" disabled></td>
                            <td style="border-top:none; text-align: center;">기계</td>
                            <td style="border-top:none; border-right:none; padding-left: 0;">
                                <select id="spec1" class="left-text e1-req" onchange="checkSelectPlaceholder(this); checkEntry1();">
                                    <option value="">선택</option>
                                </select>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td colspan="4" style="padding:0; border:none;">
                    <table style="width:100%; border:none;">
                        <colgroup><col style="width:50%;"><col style="width:18%;"><col style="width:7%;"><col style="width:25%;"></colgroup>
                        <tr>
                            <td style="border-left:none; border-top:none;"><input type="text" class="left-text" disabled></td>
                            <td style="border-top:none;">
                                <select id="task1" class="left-text e1-req" style="font-size: 8pt;" onchange="updateResponsibility(1); checkEntry1(); checkSelectPlaceholder(this);">
                                    <option value="">선택</option>
                                </select>
                            </td>
                            <td style="border-top:none; padding-right: 0;">
                                <input type="text" id="resp1" class="left-text" disabled>
                            </td>
                            <td style="border-top:none; border-right:none; padding-left: 0;"><input type="text" id="pos_1" class="left-text e1-req" oninput="checkEntry1()"></td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td colspan="4" style="padding:0; border:none;">
                    <table style="width:100%; border:none;">
                        <colgroup><col style="width:25%;"><col style="width:25%;"><col style="width:25%;"><col style="width:25%;"></colgroup>
                        <tr>
                            <td style="border-left:none; border-top:none; border-bottom:2px solid black;"><input type="text" class="left-text" disabled></td>
                            <td style="border-top:none; border-bottom:2px solid black;"><input type="text" class="left-text" disabled></td>
                            <td style="border-top:none; border-bottom:2px solid black;"><input type="text" class="left-text" disabled></td>
                            <td style="border-top:none; border-bottom:2px solid black; border-right:none;"><input type="text" class="left-text" disabled></td>
                        </tr>
                    </table>
                </td>
            </tr>

            <tr class="entry2-row">
                <th rowspan="5" style="background:#fff;">2</th>
                <td style="background-color: #f0f0f0 !important; cursor: not-allowed;"></td>
                
                <td colspan="3" class="tooltip-container e2-all">
                    <input type="text" id="proj_name_2" class="left-text e2-req e2-all" onfocus="showTooltip(this)" onblur="hideTooltip(this)" oninput="checkHeadquarters(2); checkEntry2();" disabled>
                    <div class="custom-tooltip e2-all" id="tooltip_proj_name_2" style="display: none;">(예시) 00아파트 기계설비 유지관리, 00건물 기계설비 유지관리</div>
                </td>
            </tr>
            <tr class="entry2-row">
                <td><div style="display:flex;"><input type="date" id="part_start_2" class="e2-req e2-all" style="width:48%;" onchange="validateAllDates(2); checkEntry2();" disabled>~<input type="date" id="part_end_2" class="e2-req e2-all" style="width:48%;" onchange="validateAllDates(2); checkEntry2();" disabled></div></td>
                <td colspan="3" style="cursor: not-allowed;"><input type="text" class="left-text" disabled style="cursor: not-allowed;"></td>
            </tr>
            <tr class="entry2-row">
                <td colspan="4" style="padding:0; border:none;">
                    <table style="width:100%; border:none;">
                        <colgroup><col style="width:25%;"><col style="width:25%;"><col style="width:25%;"><col style="width:25%;"></colgroup>
                        <tr>
                            <td style="border-left:none; border-top:none;"><input type="text" class="left-text e2-all" disabled></td>
                            <td style="border-top:none;"><input type="text" class="left-text e2-all" disabled></td>
                            <td style="border-top:none; text-align: center;">기계</td>
                            <td style="border-top:none; border-right:none; padding-left: 0;">
                                <select id="spec2" class="left-text e2-req e2-all" onchange="checkSelectPlaceholder(this); checkEntry1(); checkEntry2();" disabled>
                                    <option value="">직무분야 선택 필요</option>
                                </select>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr class="entry2-row">
                <td colspan="4" style="padding:0; border:none;">
                    <table style="width:100%; border:none;">
                        <colgroup><col style="width:50%;"><col style="width:18%;"><col style="width:7%;"><col style="width:25%;"></colgroup>
                        <tr>
                            <td style="border-left:none; border-top:none;"><input type="text" class="left-text e2-all" disabled></td>
                            <td style="border-top:none;">
                                <select id="task2" class="left-text e2-req e2-all" style="font-size: 8pt;" onchange="updateResponsibility(2); checkSelectPlaceholder(this); checkEntry2();" disabled>
                                    <option value="">선택</option>
                                </select>
                            </td>
                            <td style="border-top:none; padding-right: 0;">
                                <input type="text" id="resp2" class="left-text e2-all" disabled>
                            </td>
                            <td style="border-top:none; border-right:none; padding-left: 0;"><input type="text" id="pos_2" class="left-text e2-req e2-all" oninput="checkEntry2()" disabled></td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr class="entry2-row">
                <td colspan="4" style="padding:0; border:none;">
                    <table style="width:100%; border:none;">
                        <colgroup><col style="width:25%;"><col style="width:25%;"><col style="width:25%;"><col style="width:25%;"></colgroup>
                        <tr>
                            <td style="border-left:none; border-top:none;"><input type="text" class="left-text e2-all" disabled></td>
                            <td style="border-top:none;"><input type="text" class="left-text e2-all" disabled></td>
                            <td style="border-top:none;"><input type="text" class="left-text e2-all" disabled></td>
                            <td style="border-top:none; border-right:none;"><input type="text" class="left-text e2-all" disabled></td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>

        <div class="footer-wrapper">
            <div style="margin-top: 10px; display:flex; justify-content:space-between; align-items:flex-end;">
                <span style="font-size: 10pt; margin-left:5px;">위와 같이 건설기술인의 경력을 확인합니다.</span>
                <span style="font-size: 10pt; margin-right:5px;">
                    <input type="tel" style="width:40px; text-align:right;" placeholder="202X">년
                    <input type="tel" style="width:30px; text-align:right;" placeholder="00">월
                    <input type="tel" style="width:30px; text-align:right;" placeholder="00">일
                </span>
            </div>
            
            <div style="position:relative; width:100%; height:50px; text-align:center; margin-top:20px;">
                <span style="font-size: 16pt; font-weight: bold; letter-spacing: -1px;">
                    발주자, 인ㆍ허가기관 또는 사용자(대표자)
                </span>
                <div style="position:absolute; right:80px; top:-10px; width:50px; height:50px; display:flex; align-items:center; justify-content:center; color:red; font-weight:bold; border:2px solid red; font-size:10pt;">
                    직인
                </div>
            </div>

            <div style="margin-top: 5px;">        
                <table style="border: 1px solid #000; border-top: 2px solid #000; width:100%; border-bottom: none;">
                    <tr>
                        <th style="background-color:#ccc; height:20px; border-bottom:3px solid #000; font-size:9pt; border-left:none; border-right:none;">유의사항</th>
                    </tr>
                    <tr>
                        <td style="padding:10px 10px; font-size:8pt; line-height:1.6; border:none; vertical-align:top; letter-spacing:-0.5px;">
                            1. 기술경력을 설계 또는 건설사업관리 사업수행능력평가에 활용하려는 경우 발주청이나 인ㆍ허가기관 직인의 경력확인서를 제출해야 하며, 입사신고 또는 일반적인 경력신고는 사용자(대표자) 직인의 경력확인서를 제출해야 합니다.<br>
                            2. ⑳ 적용 융ㆍ복합건설기술란, ㉑ 적용 신기술 등란 및 ㉒ 시설물 종류란은 발주청이나 인ㆍ허가기관의 확인이 있는 경우에만 인정됩니다.<br>
                            3. 건설기술인 본인의 서명 또는 날인이 있는 경우에는 건설기술인 경력변경신고서(「건설기술 진흥법 시행규칙」 별지 제14호서식을 말합니다)를 작성하지 않아도 되며, 입ㆍ퇴사일을 신고하는 경우 4대 보험 자료 등 증명할 수 있는 서류를 제출해야 합니다.<br>
                            4. 다수의 경력확인서를 작성해야 하는 경우에는 기술경력만을 적은 서류를 첨부하여 제출할 수 있습니다. 2장 이상은 각 장에 사용자(대표자) 또는 발주자의 확인(간인 포함)을 받아야 합니다.<br>
                            5. 신고인(본인)의 서명 또는 날인은 본인이 직접 해야 하며 타인이 이를 위조하는 경우 「형법」 제239조에 따라 처벌 받을 수 있습니다.
                        </td>
                    </tr>
                </table>
                
                <table style="border: 1px solid #000; border-top: 1px solid #000; border-bottom:2px solid #000; margin-top:-1px;">
                    <colgroup>
                        <col style="width: 10%;"> <col style="width: 12%;"> <col style="width: 25%;"> 
                        <col style="width: 13%;"> <col style="width: 40%;">
                    </colgroup>
                    <tr>
                        <th style="background:#fff; height:24px; border-left:none;">대리인</th>
                        <th style="background:#fff;">성명</th>
                        <td style="position:relative;">
                            <input type="text" class="center-text">
                            <span style="position:absolute; right:5px; top:5px; color:#aaa; font-size:6pt;">(서명 또는 인)</span>
                        </td>
                        <th style="background:#fff;">생년월일</th>
                        <td style="border-right:none; padding:0;">
                            <div style="display:flex; height:100%;">
                                <input type="tel" style="width:60%; text-align:center;">
                                <span style="border-left:1px solid #000; border-right:1px solid #000; width:100px; background:#fff; display:flex; align-items:center; justify-content:center; font-size:8pt;">연락처</span>
                                <input type="tel" style="flex-grow:1; text-align:center;">
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        </div>
</div>

<script>
    /* ★ 반응형 스케일링 스크립트 */
    function resizeForm() {
        const wrapper = document.getElementById('responsive-wrapper');
        const containerWidth = 210 * 3.78; // A4 너비 (약 794px)
        const screenWidth = window.innerWidth;
        const padding = 10; // 여백

        // 화면이 문서 원본보다 작으면 축소
        if (screenWidth < containerWidth + (padding * 2)) {
            const scale = (screenWidth - padding * 2) / containerWidth;
            wrapper.style.transform = `scale(${scale})`;
            // 스케일링으로 줄어든 만큼 높이 공간 조정 (여백 제거)
            wrapper.style.marginBottom = `-${(1 - scale) * 100}%`;
        } else {
            wrapper.style.transform = 'none';
            wrapper.style.marginBottom = '80px';
        }
    }

    // 모바일 가로 모드 전환 감지
    window.addEventListener("orientationchange", function() {
        setTimeout(resizeForm, 200); // 회전 애니메이션 후 실행
    });

    /* --- [기존 로직 함수들] --- */
    function autoFitText(el) {
        el.style.letterSpacing = 'normal';
        let hiddenSpan = document.getElementById('text-measure-span');
        if (!hiddenSpan) {
            hiddenSpan = document.createElement('span');
            hiddenSpan.id = 'text-measure-span';
            hiddenSpan.style.visibility = 'hidden';
            hiddenSpan.style.position = 'absolute';
            hiddenSpan.style.whiteSpace = 'nowrap';
            document.body.appendChild(hiddenSpan);
        }
        const computed = window.getComputedStyle(el);
        hiddenSpan.style.font = computed.font;
        hiddenSpan.style.fontSize = computed.fontSize;
        hiddenSpan.style.fontFamily = computed.fontFamily;
        hiddenSpan.style.fontWeight = computed.fontWeight;
        hiddenSpan.innerText = el.value;

        const textWidth = hiddenSpan.getBoundingClientRect().width;
        const availableWidth = el.clientWidth; 

        if (textWidth > availableWidth) {
            const length = el.value.length;
            if (length > 1) {
                const overflow = textWidth - availableWidth;
                let spacing = -1 * (overflow / (length - 1)) - 0.5; 
                if (spacing < -3) spacing = -3; 
                el.style.letterSpacing = spacing + 'px';
            }
        } else {
            el.style.letterSpacing = 'normal';
        }
    }

    async function saveToFile() {
        const data = {};
        document.querySelectorAll('input, select').forEach(el => {
            if (el.id) {
                if(el.type === 'checkbox') data[el.id] = el.checked;
                else data[el.id] = el.value;
            }
        });
        const jsonStr = JSON.stringify(data, null, 2);
        const fileName = '기계설비 유지관리자_경력확인서_데이터.json';

        if (window.showSaveFilePicker) {
            try {
                const handle = await window.showSaveFilePicker({
                    suggestedName: fileName,
                    types: [{
                        description: 'JSON Files',
                        accept: { 'application/json': ['.json'] },
                    }],
                });
                const writable = await handle.createWritable();
                await writable.write(jsonStr);
                await writable.close();
                alert('파일이 성공적으로 저장되었습니다.');
                return;
            } catch (err) {
                if (err.name === 'AbortError') { return; }
                console.error('File Picker Error:', err);
            }
        }

        const blob = new Blob([jsonStr], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    function triggerFileLoad() { document.getElementById('file_input').click(); }

    function loadFromFile(input) {
        const file = input.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                
                for (const [id, val] of Object.entries(data)) {
                    const el = document.getElementById(id);
                    if(el) {
                        if(el.type === 'checkbox') el.checked = val;
                        else {
                            el.value = val;
                            if(id === 'user_addr' || id === 'comp_name' || id === 'comp_addr') {
                                autoFitText(el);
                            }
                        }
                        if(el.tagName === 'SELECT') checkSelectPlaceholder(el);
                    }
                }
                if(document.getElementById('chk_working').checked) toggleRetireDate();

                updateSpecialty(1);
                updateSpecialty(2);
                
                const status = checkEntry1();
                if(status.allFilled) {
                    if(data['task1']) updateResponsibility(1);
                    if(data['task2']) updateResponsibility(2);
                    if(data['spec1']) document.getElementById('spec1').value = data['spec1'];
                    if(data['resp1']) document.getElementById('resp1').value = data['resp1'];
                    if(data['spec2']) document.getElementById('spec2').value = data['spec2'];
                    if(data['resp2']) document.getElementById('resp2').value = data['resp2'];
                    if(document.getElementById('spec1')) checkSelectPlaceholder(document.getElementById('spec1'));
                    if(document.getElementById('spec2')) checkSelectPlaceholder(document.getElementById('spec2'));
                }
                updateDayCalculations();
                alert("파일 불러오기가 완료되었습니다.");
            } catch (err) {
                alert("파일 형식이 올바르지 않습니다.");
            }
        };
        reader.readAsText(file);
        input.value = ''; 
    }

    function formatNumber(target, type) {
        let val = target.value.replace(/[^0-9]/g, ''); 
        let result = val;
        if(type === 'money') { if(val) result = Number(val).toLocaleString(); }
        else if(type === 'phone' && val.length > 3) { result = val.substr(0,3)+'-'+val.substr(3,4)+'-'+val.substr(7); }
        else if(type === 'id') { 
            if(val.length > 13) val = val.substr(0, 13);
            if(val.length > 6) { result = val.substr(0,6) + '-' + val.substr(6); } else { result = val; }
        }
        else if(type === 'biz' && val.length > 3) { result = val.substr(0,3)+'-'+val.substr(3,2)+'-'+val.substr(5); }
        target.value = result;
    }

    function formatCompPhone(target) {
        let val = target.value.replace(/[^0-9]/g, ''); 
        if(val.length > 12) val = val.substr(0, 12); 
        target.value = val;
    }

    function showTooltip(input) {
        if(input.disabled) return; 
        const tooltipId = 'tooltip_' + input.id;
        const tooltip = document.getElementById(tooltipId);
        if(tooltip) {
            const container = input.closest('.tooltip-container');
            if(container) {
                tooltip.style.display = 'block';
                tooltip.style.top = '24px'; 
                tooltip.style.left = '0px';
                tooltip.classList.add('show');
            }
        }
    }

    function hideTooltip(input) {
        const tooltipId = 'tooltip_' + input.id;
        const tooltip = document.getElementById(tooltipId);
        if(tooltip) { tooltip.classList.remove('show'); }
    }

    const jobData = { "기계": ["공조냉동 및 설비", "용접"] };

    function initAllFields() {
        const taskSelects = [document.getElementById('task1'), document.getElementById('task2')];
        const taskOptions = ["유지관리", "유지보수및보강"];
        taskSelects.forEach(select => {
            if(select) {
                taskOptions.forEach(key => {
                    let option = document.createElement("option");
                    option.value = key;
                    option.text = key;
                    select.appendChild(option);
                });
            }
        });
        updateSpecialty(1);
        updateSpecialty(2);
        
        const allSelects = document.querySelectorAll('select');
        allSelects.forEach(el => checkSelectPlaceholder(el));
        checkEntry1();
    }

    function checkSelectPlaceholder(el) {
        if (!el.value) { el.classList.add('empty-value'); } else { el.classList.remove('empty-value'); }
    }

    function updateSpecialty(idx) {
        const specSelect = document.getElementById('spec' + idx);
        const selectedJob = "기계"; 
        specSelect.innerHTML = '<option value="">선택</option>';
        if (selectedJob && jobData[selectedJob]) {
            jobData[selectedJob].forEach(spec => {
                let option = document.createElement("option");
                option.value = spec;
                option.text = spec;
                specSelect.appendChild(option);
            });
        }
        checkSelectPlaceholder(specSelect); 
    }

    function updateResponsibility(idx) { return; }

    function toggleRetireDate() {
        const chk = document.getElementById('chk_working');
        const dateInput = document.getElementById('retire_date');
        const textDiv = document.getElementById('retire_text');
        if (chk.checked) {
            dateInput.style.display = 'none';
            textDiv.style.display = 'block';
            dateInput.value = ''; 
        } else {
            dateInput.style.display = 'block';
            textDiv.style.display = 'none';
        }
        validateAllDates(1);
        validateAllDates(2);
    }

    function calculateDays(startDateStr, endDateStr) {
        if(!startDateStr || !endDateStr) return 0;
        const start = new Date(startDateStr);
        const end = new Date(endDateStr);
        if (start > end) return 0;
        
        const diffTime = Math.abs(end - start);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; 
        return diffDays;
    }

    function updateDayCalculations() {
        const s1 = document.getElementById('part_start_1').value;
        const e1 = document.getElementById('part_end_1').value;
        const days1 = calculateDays(s1, e1);
        document.getElementById('panel_days_1').innerText = days1;

        const s2 = document.getElementById('part_start_2').value;
        const e2 = document.getElementById('part_end_2').value;
        const days2 = calculateDays(s2, e2);
        document.getElementById('panel_days_2').innerText = days2;
    }

    function validateAllDates(idx) {
        const joinDateEl = document.getElementById('join_date');
        const retireDateEl = document.getElementById('retire_date');
        const isWorking = document.getElementById('chk_working').checked;

        if(!joinDateEl.value) joinDateEl.classList.add('required-missing');
        else joinDateEl.classList.remove('required-missing');

        if(!isWorking && !retireDateEl.value) retireDateEl.classList.add('required-missing');
        else retireDateEl.classList.remove('required-missing');

        const joinDate = joinDateEl.value;
        const retireDate = retireDateEl.value;

        if (!isWorking && joinDate && retireDate && joinDate > retireDate) {
            alert("입사일/퇴사일: 퇴사일이 입사일보다 앞설 수 없습니다.");
            document.getElementById('retire_date').value = "";
            return;
        }

        const partStartEl = document.getElementById('part_start_' + idx);
        const partEndEl = document.getElementById('part_end_' + idx);

        if (!partStartEl || !partEndEl) return;

        const partStart = partStartEl.value;
        const partEnd = partEndEl.value;

        if (partStart && partEnd && partStart > partEnd) {
            alert("참여기간: 종료일이 시작일보다 앞설 수 없습니다.");
            partEndEl.value = "";
            updateDayCalculations(); 
            return;
        }

        if (partStart && joinDate && partStart < joinDate) {
             alert(`참여기간 시작일(${partStart})은 입사일(${joinDate})보다 빠를 수 없습니다.`);
             partStartEl.value = "";
             return;
        }
        if (partEnd) {
            if (!isWorking && retireDate && partEnd > retireDate) {
                alert(`참여기간 종료일(${partEnd})은 퇴사일(${retireDate})보다 늦을 수 없습니다.`);
                partEndEl.value = "";
                return;
            }
        }

        checkOverlap();
        updateDayCalculations();
    }

    function checkOverlap() {
        const s1 = document.getElementById('part_start_1').value;
        const e1 = document.getElementById('part_end_1').value;
        const s2 = document.getElementById('part_start_2').value;
        const e2 = document.getElementById('part_end_2').value;

        if (s1 && e1 && s2 && e2) {
            if (s1 <= e2 && e1 >= s2) {
                alert("오류: 연번1과 연번2의 참여기간은 겹칠 수 없습니다.\n날짜를 다시 확인해주세요.");
                document.getElementById('part_start_2').value = "";
                document.getElementById('part_end_2').value = "";
                updateDayCalculations(); 
            }
        }
    }

    function checkHeadquarters(idx) {
        const pName = document.getElementById('proj_name_' + idx);
        const spec = document.getElementById('spec' + idx);
        if (!pName || !spec) return;
        
        if (pName.value.trim() === '본사') {
            spec.innerHTML = '<option value=""></option>';
            spec.disabled = true;
            checkSelectPlaceholder(spec); 
        } else {
            if (!pName.disabled) { 
                spec.disabled = false;
                if (spec.options.length === 1 && spec.options[0].text === "") {
                    updateSpecialty(idx);
                }
            }
        }
    }

    function checkEntry2() {
        const requiredFields2 = document.querySelectorAll('.e2-req');
        requiredFields2.forEach(el => {
            if (!el.disabled) { 
                if (!el.value.trim()) {
                    el.classList.add('required-missing'); 
                } else {
                    el.classList.remove('required-missing'); 
                }
            } else {
                el.classList.remove('required-missing'); 
            }
        });
    }

    function checkEntry1() {
        const requiredFields1 = document.querySelectorAll('.e1-req');
        let allFilled = true;
        let isCompletelyEmpty = true; 

        requiredFields1.forEach(el => {
            if (el.value.trim()) {
                isCompletelyEmpty = false;
                el.classList.remove('required-missing');
            } else {
                allFilled = false;
                el.classList.add('required-missing');
            }
        });

        const entry2Rows = document.querySelectorAll('.entry2-row');
        const entry2Inputs = document.querySelectorAll('.e2-all');
        const alertMsg = "연번1의 필수값(참여기간, 사업명, 직무분야, 전문분야, 담당업무, 직위)을 모두 입력해주세요.";

        if (allFilled) {
            entry2Inputs.forEach(el => el.disabled = false);
            entry2Rows.forEach(row => row.removeAttribute('title')); 
            const tooltip2 = document.getElementById('tooltip_proj_name_2');
            if(tooltip2) tooltip2.style.display = 'block';
            checkHeadquarters(2); 
            checkEntry2();
        } else {
            entry2Inputs.forEach(el => {
                el.disabled = true;
                el.value = "";
                el.classList.remove('required-missing'); 
                if(el.tagName === 'SELECT') checkSelectPlaceholder(el);
            });
            entry2Rows.forEach(row => row.setAttribute('title', alertMsg)); 
            const tooltip2 = document.getElementById('tooltip_proj_name_2');
            if(tooltip2) tooltip2.style.display = 'none';
            updateDayCalculations();
        }
        return { allFilled, isCompletelyEmpty };
    }

    function validateAndPrint() {
        const status1 = checkEntry1();
        if (status1.isCompletelyEmpty) { window.print(); return; }
        if (!status1.allFilled) {
            alert("연번1의 필수값(참여기간, 사업명, 직무분야, 전문분야, 담당업무, 직위)을 모두 입력해주세요.");
            return;
        }

        const entry2InputsAll = document.querySelectorAll('.e2-all');
        let isEntry2Started = false;
        entry2InputsAll.forEach(el => { if (el.value.trim()) isEntry2Started = true; });

        if (isEntry2Started) {
            const requiredFields2 = document.querySelectorAll('.e2-req');
            let allFilled2 = true;
            requiredFields2.forEach(el => {
                if (!el.value.trim()) {
                    allFilled2 = false;
                    el.classList.add('required-missing'); 
                } else {
                    el.classList.remove('required-missing');
                }
            });
            if (!allFilled2) {
                alert("연번2를 작성 중입니다. 연번2의 필수값을 모두 입력해주세요.\n(입력하지 않으려면 연번2 내용을 모두 지워주세요)");
                return;
            }
        }
        window.print();
    }
</script>

</body>
</html>
